<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor d'Ítems</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
        }

        .item-list {
            margin: 20px 0;
        }

        .item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f4f4f4;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 4px;
        }

        .item img {
            max-width: 50px;
            max-height: 50px;
            margin-right: 10px;
        }

        .item-info {
            display: flex;
            align-items: center;
        }

        .item-info div {
            margin-left: 10px;
        }

        .controls button {
            margin: 0 5px;
        }

        .form-container {
            margin: 20px 0;
        }

        .form-container input, .form-container textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .form-container button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .form-container button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gestor d'Ítems</h1>

        <div>
            <input type="text" id="search" placeholder="Filtrar ítems...">
        </div>

        <div class="item-list" id="item-list"></div>

        <div class="form-container">
            <h2 id="form-title">Crear Nou Ítem</h2>
            <input type="text" id="item-name" placeholder="Nom de l'ítem" required>
            <textarea id="item-description" placeholder="Descripció de l'ítem"></textarea>
            <input type="text" id="item-url" placeholder="URL de la imatge (opcional)">
            <button id="save-button">Guardar</button>
        </div>
    </div>

    <script>
        class Item {
            constructor(name, description, url = null) {
                this.name = name;
                this.description = description;
                this.url = url;
                this.creationDate = new Date().toLocaleString();
                this.lastModified = this.creationDate;
            }

            update(description, url) {
                this.description = description;
                this.url = url;
                this.lastModified = new Date().toLocaleString();
            }
        }

        class ItemManager {
            constructor() {
                this.items = [];
                this.filteredItems = [];
                this.editingItem = null;
                this.loadItems();
                this.renderItems();
            }

            loadItems() {
                const savedItems = JSON.parse(localStorage.getItem('items')) || [];
                this.items = savedItems.map(item => Object.assign(new Item(), item));
            }

            saveItems() {
                localStorage.setItem('items', JSON.stringify(this.items));
            }

            addItem(item) {
                if (this.items.some(existing => existing.name === item.name)) {
                    alert('Ja existeix un ítem amb aquest nom!');
                    return;
                }
                this.items.push(item);
                this.saveItems();
                this.renderItems();
            }

            updateItem(name, description, url) {
                const item = this.items.find(i => i.name === name);
                if (item) {
                    item.update(description, url);
                    this.saveItems();
                    this.renderItems();
                }
            }

            deleteItem(name) {
                this.items = this.items.filter(i => i.name !== name);
                this.saveItems();
                this.renderItems();
            }

            filterItems(query) {
                if (!query) {
                    this.filteredItems = [...this.items];
                } else {
                    const exactMatch = this.items.filter(i => i.name.toLowerCase() === query.toLowerCase());
                    const startsWith = this.items.filter(i => i.name.toLowerCase().startsWith(query.toLowerCase()) && !exactMatch.includes(i));
                    const contains = this.items.filter(i => i.name.toLowerCase().includes(query.toLowerCase()) && !exactMatch.includes(i) && !startsWith.includes(i));
                    this.filteredItems = [...exactMatch, ...startsWith, ...contains];
                }
                this.renderItems();
            }

            renderItems() {
                const itemList = document.getElementById('item-list');
                itemList.innerHTML = '';
                const itemsToRender = this.filteredItems.length ? this.filteredItems : this.items;
                itemsToRender.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';

                    const itemInfo = document.createElement('div');
                    itemInfo.className = 'item-info';

                    if (item.url) {
                        const img = document.createElement('img');
                        img.src = item.url;
                        itemInfo.appendChild(img);
                    }

                    const infoDiv = document.createElement('div');
                    infoDiv.innerHTML = `<strong>${item.name}</strong><br>Creat: ${item.creationDate}<br>Última modificació: ${item.lastModified}`;
                    itemInfo.appendChild(infoDiv);

                    const controls = document.createElement('div');
                    controls.className = 'controls';
                    controls.innerHTML = `
                        <button onclick="editItem('${item.name}')">Editar</button>
                        <button onclick="deleteItem('${item.name}')">Eliminar</button>
                    `;

                    itemDiv.appendChild(itemInfo);
                    itemDiv.appendChild(controls);
                    itemList.appendChild(itemDiv);
                });
            }
        }

        const manager = new ItemManager();

        document.getElementById('save-button').addEventListener('click', () => {
            const name = document.getElementById('item-name').value;
            const description = document.getElementById('item-description').value;
            const url = document.getElementById('item-url').value;

            if (!name) {
                alert('El nom és obligatori!');
                return;
            }

            if (manager.editingItem) {
                manager.updateItem(name, description, url);
                manager.editingItem = null;
                document.getElementById('form-title').textContent = 'Crear Nou Ítem';
            } else {
                manager.addItem(new Item(name, description, url));
            }

            document.getElementById('item-name').value = '';
            document.getElementById('item-description').value = '';
            document.getElementById('item-url').value = '';
        });

        document.getElementById('search').addEventListener('input', (e) => {
            manager.filterItems(e.target.value);
        });

        window.editItem = (name) => {
            const item = manager.items.find(i => i.name === name);
            if (item) {
                document.getElementById('item-name').value = item.name;
                document.getElementById('item-description').value = item.description;
                document.getElementById('item-url').value = item.url || '';
                manager.editingItem = item;
                document.getElementById('form-title').textContent = 'Editar Ítem';
            }
        };

        window.deleteItem = (name) => {
            if (confirm('Segur que vols eliminar aquest ítem?')) {
                manager.deleteItem(name);
            }
        };
    </script>
</body>
</html>
